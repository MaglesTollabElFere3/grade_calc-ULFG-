<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Grade calc</title>
<style>
:root{
  --blue:#1e3a5f;--blue2:#2f5fa3;--bg:#0b1220;--card:#111a2e;--text:#fff;
}
body{margin:0;font-family:Arial;background:var(--bg);color:var(--text)}
header{background:var(--blue);padding:20px;position:relative;text-align:center}
header img{position:absolute;left:20px;top:10px;width:90px}
header h1{margin:0;font-size:28px}
table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{border:1px solid #2a3d5c;padding:10px;text-align:center}
th{background:#223a5e}
input{width:80px;padding:5px;text-align:center}
button{padding:6px 12px;background:var(--blue2);color:#fff;border:none;border-radius:6px;cursor:pointer}
.avg{font-weight:bold;font-size:18px}
.fail{color:#c0392b;font-weight:600}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center}
.modal-box{background:#fff;color:#000;padding:20px;border-radius:10px;text-align:center}
</style>
</head>
<body>
<header>
<img src="logo.png" />
<h1>Grade calc</h1>
</header>

<table id="tbl">
<thead>
<tr>
<th>المادة</th><th>Credits</th><th>Partial</th><th>Final</th><th>Raise</th><th>Average</th><th>Action</th>
</tr>
</thead>
<tbody></tbody>
</table>
<br>
<button onclick="addRow()">إضافة مادة</button>

<div class="modal" id="modal">
<div class="modal-box">
<h3>معدل الدفعة</h3>
<input id="cp" placeholder="Partial" type="number"><br>
<input id="cf" placeholder="Final" type="number"><br><br>
<button onclick="confirmRaise()">OK</button>
</div>
</div>

<script>
let activeRow=null;

function addRow(){
 const tr=document.createElement('tr');
 tr.dataset.raise=0;tr.dataset.submitted='false';
 tr.innerHTML=`
 <td><input></td>
 <td><input type="number"></td>
 <td><input type="number"></td>
 <td><input type="number"></td>
 <td><span>0</span></td>
 <td class="avg">0</td>
 <td><button onclick="toggleSubmit(this)">Submit</button> <button onclick="openRaise(this)">Raise</button></td>`;
 document.querySelector('#tbl tbody').appendChild(tr);
}

function toggleSubmit(btn){
 const tr=btn.closest('tr');
 const inputs=tr.querySelectorAll('input');
 const avgCell=tr.querySelector('.avg');
 if(tr.dataset.submitted==='false'){
   const p=+inputs[2].value,f=+inputs[3].value;
   const hi=Math.max(p,f),lo=Math.min(p,f);
   const base=hi*0.6+lo*0.4;
   tr.dataset.base=base;
   const finalAvg=base+Number(tr.dataset.raise);
   avgCell.textContent=finalAvg.toFixed(2);
   if(finalAvg<60) avgCell.classList.add('fail'); else avgCell.classList.remove('fail');
   inputs.forEach(i=>{i.dataset.v=i.value;i.style.display='none';i.insertAdjacentHTML('afterend',`<span>${i.value}</span>`)});
   btn.textContent='Edit';
   tr.dataset.submitted='true';
 } else {
   tr.querySelectorAll('span').forEach(s=>{if(s.previousSibling?.tagName==='INPUT') s.remove()});
   inputs.forEach(i=>i.style.display='inline');
   btn.textContent='Submit';
   tr.dataset.submitted='false';
 }
}

function openRaise(btn){activeRow=btn.closest('tr');document.getElementById('modal').style.display='flex';}

function confirmRaise(){
 const cp=+document.getElementById('cp').value;
 const cf=+document.getElementById('cf').value;
 const hi=Math.max(cp,cf),lo=Math.min(cp,cf);
 const classAvg=hi*0.6+lo*0.4;
 let raise=0;if(classAvg<66) raise=66-classAvg;
 activeRow.dataset.raise=raise;
 activeRow.querySelector('td:nth-child(5) span').textContent=raise.toFixed(2);
 if(activeRow.dataset.submitted==='true'){
   const base=Number(activeRow.dataset.base);
   const avgCell=activeRow.querySelector('.avg');
   const finalAvg=base+raise;
   avgCell.textContent=finalAvg.toFixed(2);
   if(finalAvg<60) avgCell.classList.add('fail'); else avgCell.classList.remove('fail');
 }
 document.getElementById('modal').style.display='none';
}
</script>
</body>
</html>
