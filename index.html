<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Grade Calc</title>
  <style>
    :root {
      --blue: #2563eb;
      --bg-light: #f5f7fb;
      --bg-dark: #0f172a;
      --card-light: #ffffff;
      --card-dark: #1e293b;
      --text-light: #0f172a;
      --text-dark: #e5e7eb;
      --fail: #b91c1c;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-light);
      color: var(--text-light);
    }

    body.dark {
      background: var(--bg-dark);
      color: var(--text-dark);
    }

    header {
      padding: 16px;
      text-align: center;
      position: relative;
    }

    h1 {
      margin: 8px 0;
      color: var(--blue);
    }

    .ayah {
      font-size: 1.4rem;
      margin-bottom: 10px;
    }

    .container {
      padding: 16px;
      max-width: 1000px;
      margin: auto;
    }

    .controls {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }

    button {
      padding: 10px 16px;
      border: none;
      border-radius: 10px;
      background: var(--blue);
      color: white;
      font-size: 1rem;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 10px;
      text-align: center;
    }

    thead {
      background: rgba(37, 99, 235, 0.1);
    }

    tr.card {
      background: var(--card-light);
      border-radius: 14px;
    }

    body.dark tr.card {
      background: var(--card-dark);
    }

    input {
      width: 80px;
      padding: 6px;
      text-align: center;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    .printed {
      font-weight: bold;
    }

    .fail {
      color: var(--fail);
      font-weight: bold;
    }

    .overall {
      margin-top: 20px;
      font-size: 1.3rem;
      text-align: center;
    }
  </style>
</head>
<body>
  <header>
    <div class="ayah">{ÙˆÙÙ‚ÙÙ„Ù’ Ø±ÙØ¨ÙÙ‘ Ø²ÙØ¯Ù’Ù†ÙÙŠ Ø¹ÙÙ„Ù’Ù…Ù‹Ø§}</div>
    <h1>Grade Calc</h1>
    <button onclick="toggleTheme()">ğŸŒ™ / â˜€ï¸</button>
  </header>

  <div class="container">
    <div class="controls">
      <button onclick="addRow()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©</button>
      <button onclick="addRaise()">â¬†ï¸ Raise</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
          <th>Credits</th>
          <th>Partial</th>
          <th>Final</th>
          <th>Average</th>
          <th>Raise</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>

    <div class="overall">
      Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ù…: <span id="overallAvg">â€”</span>
    </div>
  </div>

  <script>
    let currentRaise = 0;

    function toggleTheme() {
      document.body.classList.toggle('dark');
    }

    function addRow() {
      const tr = document.createElement('tr');
      tr.className = 'card subject-row';
      tr.innerHTML = `
        <td><input placeholder="Ø§Ø³Ù…" /></td>
        <td><input class="credit" type="number" /></td>
        <td><input class="partial" type="number" /></td>
        <td><input class="final" type="number" /></td>
        <td class="avg">â€”</td>
        <td class="raise">â€”</td>
        <td>
          <button onclick="submitRow(this)">Submit</button>
          <button onclick="addRaise(this)">Raise</button>
        </td>
      `;
      document.getElementById('tbody').appendChild(tr);
    }

    function submitRow(btn) {
      const row = btn.closest('tr');
      const credit = parseFloat(row.querySelector('.credit').value);
      const p = parseFloat(row.querySelector('.partial').value);
      const f = parseFloat(row.querySelector('.final').value);

      if (isNaN(credit) || isNaN(p) || isNaN(f)) return;

      const high = Math.max(p, f);
      const low = Math.min(p, f);
      const avg = high * 0.6 + low * 0.4; // Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø¨Ø¯ÙˆÙ† Ø±Ø§ÙŠØ²

      row.querySelector('.avg').innerHTML = `<span class="final-grade ${avg < 60 ? 'fail' : ''}" data-base="${avg}">${avg.toFixed(2)}</span>`;
      row.querySelector('.credit').outerHTML = `<span class="credit-value printed">${credit}</span>`;

      row.querySelectorAll('input').forEach(i => i.outerHTML = `<span class="printed">${i.value}</span>`);
      btn.outerHTML = `<button onclick="editRow(this)">Edit</button>`;

      calculateOverallAverage();
    }

    function editRow(btn) {
      location.reload();
    }

    function addRaise(btn) {
      const row = btn.closest('tr');
      const val = prompt('Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù€ Raise Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø§Ø¯Ø© ÙÙ‚Ø·:');
      if (val === null) return;

      const raiseVal = parseFloat(val) || 0;
      const gradeEl = row.querySelector('.final-grade');
      if (!gradeEl) return;

      const base = parseFloat(gradeEl.dataset.base);
      if (isNaN(base)) return;

      const newGrade = base + raiseVal;
      gradeEl.textContent = newGrade.toFixed(2);
      gradeEl.classList.toggle('fail', newGrade < 60);

      row.querySelector('.raise').textContent = raiseVal.toFixed(2);

      calculateOverallAverage();
    }

    function calculateOverallAverage() {
      let sum = 0;
      let credits = 0;

      document.querySelectorAll('.subject-row').forEach(row => {
        const g = row.querySelector('.final-grade');
        const c = row.querySelector('.credit-value');
        if (!g || !c) return;

        const grade = parseFloat(g.textContent); // Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø±Ø§ÙŠØ²
        const credit = parseFloat(c.textContent);

        if (!isNaN(grade) && !isNaN(credit)) {
          sum += grade * credit;
          credits += credit;
        }
      });

      if (credits === 0) {
        overallAvg.textContent = 'â€”';
        return;
      }

      const result = sum / credits;
      overallAvg.textContent = result.toFixed(2);
    });

      if (credits === 0) {
        overallAvg.textContent = 'â€”';
        return;
      }

      let result = sum / credits + currentRaise;
      overallAvg.textContent = result.toFixed(2);
    }
  </script>
</body>
</html>
