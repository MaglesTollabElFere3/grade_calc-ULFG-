<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Grade calc</title>
  <style>
    :root{
      --blue:#1e5aa8;
      --bg-light:#f4f6f9;
      --bg-dark:#0f172a;
      --card-light:#ffffff;
      --card-dark:#1e293b;
      --text-light:#0f172a;
      --text-dark:#e5e7eb;
      --fail:#f8d7da;
    }
    body{
      margin:0;
      font-family: system-ui, -apple-system, sans-serif;
      background:var(--bg-light);
      color:var(--text-light);
      transition:0.3s;
    }
    body.dark{
      background:var(--bg-dark);
      color:var(--text-dark);
    }
    header{
      background:var(--blue);
      color:white;
      padding:15px;
      position:relative;
      text-align:center;
    }
    header img{
      position:absolute;
      top:10px;
      right:10px;
      width:70px;
    }
    .ayah{
      font-size:26px;
      margin-top:5px;
    }
    .container{
      padding:20px;
      max-width:1000px;
      margin:auto;
    }
    .controls{
      display:flex;
      gap:15px;
      justify-content:space-between;
      align-items:center;
      margin-bottom:15px;
    }
    table{
      width:100%;
      border-collapse:collapse;
    }
    th,td{
      border:1px solid #ccc;
      padding:8px;
      text-align:center;
    }
    body.dark th, body.dark td{border-color:#334155;}
    th{background:#e8eef8;}
    body.dark th{background:#24344d;}
    tr.fail{background:var(--fail);}
    button{
      padding:6px 10px;
      cursor:pointer;
    }
    .add{
      background:var(--blue);
      color:white;
      border:none;
    }
    .theme{
      cursor:pointer;
    }
    .modal{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.6);
      display:none;
      align-items:center;
      justify-content:center;
    }
    .modal-content{
      background:white;
      padding:20px;
      width:300px;
    }
    body.dark .modal-content{background:var(--card-dark);}
    .modal-content input{
      width:100%;
      margin:5px 0;
      padding:6px;
    }
    .avg-box{
      font-weight:bold;
    }
  </style>
</head>
<body>
<header>
  <img src="logo.png" alt="logo" />
  <h1>Grade calc</h1>
  <div class="ayah" id="ayah">{ÙˆÙÙ‚ÙÙ„Ù’ Ø±ÙØ¨ÙÙ‘ Ø²ÙØ¯Ù’Ù†ÙÙŠ Ø¹ÙÙ„Ù’Ù…Ù‹Ø§}</div>
</header>

<div class="container">
  <div class="controls">
    <button class="add" onclick="addRow()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©</button>
    <label class="theme">
      ğŸŒ™ <input type="checkbox" onchange="toggleTheme()" />
    </label>
  </div>

  <table id="table">
    <thead>
      <tr>
        <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
        <th>Credits</th>
        <th>Partial</th>
        <th>Final</th>
        <th>Average</th>
        <th>Raise</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h3 id="gpa">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ù…: --</h3>
</div>

<div class="modal" id="modal">
  <div class="modal-content">
    <h3>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¯ÙØ¹Ø©</h3>
    <input id="mp" type="number" placeholder="Partial avg" />
    <input id="mf" type="number" placeholder="Final avg" />
    <button onclick="applyRaise()">OK</button>
  </div>
</div>

<script>
let currentRow=null;

function addRow(){
  const tr=document.createElement('tr');
  tr.innerHTML=`
    <td><input></td>
    <td><input type="number"></td>
    <td><input type="number" oninput="calc(this)"></td>
    <td><input type="number" oninput="calc(this)"></td>
    <td class="avg-box">--</td>
    <td><button onclick="openRaise(this)">Raise</button></td>
  `;
  document.querySelector('tbody').appendChild(tr);
}

function calc(el){
  const tr=el.closest('tr');
  const p=+tr.children[2].firstChild.value||0;
  const f=+tr.children[3].firstChild.value||0;
  const high=Math.max(p,f);
  const low=Math.min(p,f);
  let avg=high*0.6+low*0.4;
  tr.children[4].textContent=avg.toFixed(2);
  tr.classList.toggle('fail',avg<60);
  calcGPA();
}

function openRaise(btn){
  currentRow=btn.closest('tr');
  modal.style.display='flex';
}

function applyRaise(){
  const mp=+document.getElementById('mp').value;
  const mf=+document.getElementById('mf').value;
  const high=Math.max(mp,mf);
  const low=Math.min(mp,mf);
  const classAvg=high*0.6+low*0.4;
  if(classAvg<66){
    const raise=66-classAvg;
    let avg=parseFloat(currentRow.children[4].textContent);
    avg=Math.min(100,avg+raise);
    currentRow.children[4].textContent=avg.toFixed(2);
    currentRow.classList.toggle('fail',avg<60);
  }
  modal.style.display='none';
  document.getElementById('mp').value='';
  document.getElementById('mf').value='';
  calcGPA();
}

function calcGPA(){
  let sum=0,credits=0;
  document.querySelectorAll('tbody tr').forEach(tr=>{
    const c=+tr.children[1].firstChild.value||0;
    const a=parseFloat(tr.children[4].textContent);
    if(!isNaN(a)){
      sum+=a*c;
      credits+=c;
    }
  });
  document.getElementById('gpa').textContent=
    credits?`Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ù…: ${(sum/credits).toFixed(2)}`:'Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ù…: --';
}

function toggleTheme(){document.body.classList.toggle('dark');}
</script>
</body>
</html>
